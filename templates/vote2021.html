{% extends "base.html" %}
{% load static %}
{% block content %}
		{% for region, counts in vote2021_table.items %}
	<div class="row col-12 mx-auto my-2" style="color:#FFF;">
		<div class="card m-auto">
			<div class="card-header col-12 m-auto">
				<h2>2021 {{ region }} Komodo Notary Node Election Vote Tally</h2>
			</div>
			<div class="card-body m-auto col-12">
				<table id="{{ region }}_table" class="table table-striped table-bordered kmd_ui_light4">
					<thead>
						<tr>
							<th data-data="rank">Rank</th>
							<th data-data="candidate">Candidate</th>
							<th data-data="num_votes">Num Votes</th>
							<th data-data="sum_votes">Sum Votes</th>
							<th data-data="detail">Detail</th>
						</tr>
					</thead>
					<tbody>
						{% for item in counts %}
							<tr>
								<td data-data="rank">{{ item.region_rank }}</td>
								<td data-data="candidate">{{ item.candidate }}</td>
								<td data-data="num_votes">{{ item.num_votes }}</td>
								<td data-data="sum_votes">{{ item.sum_votes }}</td>
								<td data-data="detail" class="px-2">
									<a href="//{{ request.get_host }}/candidate_vote2021_detail/?candidate={{ item.candidate }}&season={{ season }}">
										<span class='badge kmd_ui_dark1_bg p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='{{ item.candidate }} votes detail'>
											<i class='fas fa-arrow-right'></i>
										</span>
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>	
	</div>
		{% endfor %}
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  	
  	<script>
	    $(document).ready(function() {
	        AR_table = $('#AR_table').DataTable({  "pageLength": 50,
        		order: [[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "rank" },
			        { "data": "candidate" },
			        { "data": "num_votes" },
			        { "data": "sum_votes" },
			        { "data": "detail" },
			    ],
        		"columnDefs": [
			    ]
	        });
	        EU_table = $('#EU_table').DataTable({  "pageLength": 50,
        		order: [[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "rank" },
			        { "data": "candidate" },
			        { "data": "num_votes" },
			        { "data": "sum_votes" },
			        { "data": "detail" },
			    ]
	        });
	        NA_table = $('#NA_table').DataTable({  "pageLength": 50,
        		order: [[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "rank" },
			        { "data": "candidate" },
			        { "data": "num_votes" },
			        { "data": "sum_votes" },
			        { "data": "detail" },
			    ]
	        });
	        SH_table = $('#SH_table').DataTable({  "pageLength": 50,
        		order: [[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "rank" },
			        { "data": "candidate" },
			        { "data": "num_votes" },
			        { "data": "sum_votes" },
			        { "data": "detail" },
			    ]
	        });
		    AR_table.rows().every( function (index) {
		    	var row = AR_table.row(index);
			    var d = row.data();
			    console.log(d.rank)
			    console.log(d.sum_votes)
			    if (d.rank <= 11) {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_green' );
			    } else if (d.sum_votes == "DISQUALIFIED") {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_red' );			    	
			    } else {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_gray' );			    	
			    }
			} );
		    EU_table.rows().every( function (index) {
		    	var row = EU_table.row(index);
			    var d = row.data();
			    console.log(d)
			    console.log(d.rank)
			    if (d.rank <= 11) {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_green' );
			    } else if (d.sum_votes == "DISQUALIFIED") {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_red' );			    	
			    } else {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_gray' );			    	
			    }
			} );
		    NA_table.rows().every( function (index) {
		    	var row = NA_table.row(index);
			    var d = row.data();
			    console.log(d)
			    console.log(d.rank)
			    if (d.rank <= 11) {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_green' );
			    } else if (d.sum_votes == "DISQUALIFIED") {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_red' );			    	
			    } else {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_gray' );			    	
			    }
			} );
		    SH_table.rows().every( function (index) {
		    	var row = SH_table.row(index);
			    var d = row.data();
			    console.log(d)
			    console.log(d.rank)
			    if (d.rank <= 11) {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_green' );
			    } else if (d.sum_votes == "DISQUALIFIED") {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_red' );			    	
			    } else {
			    	row
			    	.nodes()
				    .to$()    
					.addClass( 'kmd_gray' );			    	
			    }
			} );
	    });
    </script> 
{% endblock %}
