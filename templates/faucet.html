{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 m-auto" style="color:#FFF;">
		<div class="card-deck d-flex justify-content-between col-12 m-auto">
			<div class="card text-center kmd_ui_dark2_bg kmd_ui_light3 col-12 px-0 mt-auto shadow-none">
				<div class="card-header kmd_ui_dark1_bg d-flex justify-content-between">
					<h4 class="m-auto">RICK / MORTY Faucet</h4>
				</div>
				<div class="card-body kmd_ui_dark1_bg p-0">
					<p class="card-text">
						<div class="m-auto">
                			{% if result == 'fail' %}
								<img src="{% static 'img/faucet/drink_fail.gif' %}" />
                			{% elif result == 'disqualified' %}
								<img src="{% static 'img/faucet/disqualified.gif' %}" />
                			{% elif result == 'RICK_success' %}
								<img src="{% static 'img/faucet/rick_drink.png' %}" />
                			{% elif result == 'MORTY_success' %}
								<img src="{% static 'img/faucet/morty_drink.png' %}" />
                			{% else %}
								<img src="{% static 'img/faucet/faucet.png' %}" />
                			{% endif %}                            			
						</div>
					</p>
					<p class="card-text">
						<form action="#" method="post" class="col-6 m-auto">
							{% csrf_token %}
							<fieldset>
							<div class="form-group">
							  <label class="col-md-4 control-label" for="coin">Coin</label>
							  <span class="col-md-2">
							    <select id="coin" name="coin" class="form-control">
							      <option value="RICK">RICK</option>
							      <option value="MORTY">MORTY</option>
							    </select>
							  </span>
							</div>
							<div class="form-group">
							  <label class="col-md-4 control-label" for="address">Address</label>  
							  <span class="col-md-4">
							  	<input id="address" name="address" type="text" placeholder="RTUfq3PgPPMVY1YZa3P18icFNDsHpicKLe" class="form-control input-md">
							    
							  </span>
							</div>
							<div class="form-group col-4 m-auto">
						    	<input type="submit" value="DRIP">
						    </div>
							</fieldset>
						</form>
					</p>
				</div>
			</div>
		</div>
	</div>

	<div class="row col-12 mx-auto my-1" style="color:#FFF;">
		<div class="card kmd_ui_dark1_bg m-auto col-12">
			<div class="card-header kmd_ui_dark1_bg m-auto">
				<h4>Last 200 Faucet Transactions</h4>
			</div>			
			<div class="card-body kmd_ui_dark1_bg m-auto col-12">
				<table id="faucet_tx_tbl" class="table table-striped table-bordered kmd_ui_light4 m-2" style="width:99%">
					<thead>
						<tr>
							<th data-data="index">INDEX</th>
							<th data-data="coin">COIN</th>
							<th data-data="address">ADDRESS</th>
							<th data-data="txid">TXID</th>
							<th data-data="amount">AMOUNT</th>
							<th data-data="status">STATUS</th>
							<th data-data="time_sent">Time Sent</th>
						</tr>
					</thead>
					<tbody>
					{% for row in tx_rows %}
						<tr>
							<td data-data="index">{{ row.index }}</td>
							<td style="font-size: 0.9em;" data-data="coin">{{ row.coin }}</td>
							<td style="font-size: 0.8em;" data-data="address">{{ row.address }}</td>
							<td style="font-size: 0.7em;" data-data="txid">{{ row.txid }}</td>
							<td style="font-size: 0.8em;" data-data="amount">{{ row.amount }}</td>
							<td data-data="status">{{ row.status }}</td>
							<td style="font-size: 0.8em;" data-data="time_sent">{{ row.time_sent }}</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="card-header kmd_ui_dark1_bg m-auto">
				<div class="m-auto">Rick Supply: {{ faucet_supply.RICK }}</div>
				<div class="m-auto">Morty Supply: {{ faucet_supply.MORTY }}</div>
				<div class="m-auto">24 hr Transactions: {{ count_24hrs }}</div>
				<div class="m-auto">24 hr Drip Value: {{ sum_24hrs }}</div>
			</div>
		</div>
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script type="text/javascript">
	    $(document).ready(function() {
	    	// $('#mined_24hr_tbl').css('visibility', 'visible');
	        $('#faucet_tx_tbl').DataTable({
  				"pageLength": 20,
        		order: [[ 5, 'asc' ],[ 0, 'desc' ]],
        		"columnDefs": [
        			{
			            "data": 'index',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<span class='badge kmd_ui_dark1_bg p-2'>"+oData.index+"</span>");
				        }
			        },
        			{
			            "data": 'coin',
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<a href='//{{ request.get_host }}/coin_profile/"+oData.coin+"'>"+oData.coin+"</a>");
				        }
			        },
        			{
			            "data": 'address',
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.address == 'GalacticFederationPrison') {
				            	$(nTd).html("<a href='https://www.galacticfederation.org.uk/'>"+oData.address+"</a>");
			            		
			            	}
			            	else {
				            	$(nTd).html("<a href='https://"+oData.coin+".explorer.dexstats.info/address/"+oData.address+"'>"+oData.address+"</a>");
				        	}	
				        }
			        },
        			{
			            "data": 'txid',
			            "targets": 3,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.txid == 'n/a') {
				            	$(nTd).html(oData.txid);
			            		
			            	}
			            	else {
				            	$(nTd).html("<a href='https://"+oData.coin+".explorer.dexstats.info/tx/"+oData.txid+"'>"+oData.txid.slice(0, 12)+"..."+oData.txid.slice(-12)+"</a>");
				            }
				        }
			        },
        			{
			            "data": 'status',
			            "targets": 5,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<span class='badge kmd_ui_dark1_bg p-2'>"+oData.status+"</span>");
				        }
			        }
			    ]
	        });
	    });
	</script>

{% endblock %}
