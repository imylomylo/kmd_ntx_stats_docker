{% extends "base2.html" %}
{% load static %}
{% block content %}
	<div class="container text-center" width='90%'>
		<div id="ui-view">
			<div class="fade-in">
				<div class="row my-3">
					<div class="card-deck d-flex justify-content-between col-12 m-auto">
						<div class="card text-center kmd_ui_dark2_bg kmd_ui_light3 col-12 px-0 mt-auto shadow-none">
							<div class="card-body kmd_ui_dark2_bg p-0">
								<p class="card-text">
									<!--
									<p>{{ notary_funding }}</p>
									<p>{{ bot_balance_deltas }}</p>
									-->
									<ul class="list-group">
									  <li class="list-group-item border-0">
									  	<span data-toggle="tooltip" data-placement="left" data-html="true" title="" data-original-title="
									  	<h4 class='kmd_teal'>{{ ok_balance_chains|length }}/{{ chain_list|length }} ({{ chains_funded_pct }}%) chains are sufficiently funded</h4>
										<h5 class='kmd_secondary_green'>{{ ok_balance_chains }}<br /> are sufficiently funded with all notaries</h5>
										<h5 class='kmd_secondary_orange'>{{ no_data_chains }}<br /> are not returning data</h5>
										<h5 class='kmd_secondary_red'>{{ low_balance_chains }}<br /> have at least 1 notary with a low balance </h5>">
				                            <a class="dropdown-item d-block" href="#">
				                                <div class="mb-1">
				                                    <i class="cil-layers"></i> dPoW Chains Funding
				                                </div>
				                                <span class="progress">
				                                    <div class="progress-bar kmd_dkteal" role="progressbar" style="width: {{ chains_funded_pct }}%" aria-valuenow="{{ chains_funded_pct }}" aria-valuemin="0" aria-valuemax="100">{{ chains_funded_pct }}%</div>
				                                </span>
				                                <small class="text-uppercase text-muted">{{ chains_funded_pct }}% dPoW chains with sufficient funding for all notaries</small>
				                            </a>
				                        </span>								    
									  </li>
									  <li class="list-group-item border-0">
									  	<span data-toggle="tooltip" data-placement="left" data-html="true" title="" data-original-title="
									  	<h4 class='kmd_teal'>{{ ok_balance_notaries|length }}/{{ notaries_list|length }} ({{ notaries_funded_pct }}%) chains are sufficiently funded</h4>
										<h5 class='kmd_secondary_green'>{{ ok_balance_notaries }}<br /> have sufficient balance on all chains</h5>
										<h5 class='kmd_secondary_red'>{{ low_balance_notaries }}<br /> have a low balance on at least 1 chain</h5>">
				                            <a class="dropdown-item d-block" href="#">
				                                <div class="mb-1">
				                                    <i class="cil-balance-scale"></i> Notary Funding
				                                </div>
				                                <span class="progress">
				                                    <div class="progress-bar kmd_dkteal" role="progressbar" style="width: {{ notaries_funded_pct }}%" aria-valuenow="{{ notaries_funded_pct }}" aria-valuemin="0" aria-valuemax="100">{{ notaries_funded_pct }}%</div>
				                                </span>
				                                <small class="text-uppercase text-muted">{{ notaries_funded_pct }}% Notaries with sufficient funding on all chains</small>
				                            </a>
				                        </span>								    
									  </li>
									</ul> 							
								</p>
							</div>
						</div>
					</div>
				</div>	
				<div class="row my-3">
					<div class="card-deck d-flex justify-content-between col-12 m-auto">
						<div class="card kmd_ui_light4">
							<div class="card-header kmd_ui_dark1_bg">
								{{ notary_name }} LOW BALANCE ADDRESSES<br />
								Last updated: {{ last_balances_update }}
							</div>
							<div class="card-body kmd_ui_dark1_bg">
								<table id="table_id" class="table table-striped table-bordered kmd_ui_light4 m-auto" style="width:99%">
									<thead>
										<tr>
											<th>NOTARY</th>
											<th>CHAIN</th>
											<th>ADDRESS</th>
											<th>BALANCE</th>
										</tr>
									</thead>
									<tbody>
										{% for notary, notary_data in low_nn_balances.items %}
											{% for chain, chain_data in notary_data.items %}
												<tr>
													{% if chain == "KMD_3P" %}
													<td>{{ notary }}</td>
													<td>KMD</td>
													<td style="text-transform: none;">{{ chain_data.address }}</td>
													<td>{{ chain_data.balance }} (3P)</td>
													{% else %}
													<td>{{ notary }}</td>
													<td>{{ chain }}</td>
													<td style="text-transform: none;">{{ chain_data.address }}</td>
													<td>{{ chain_data.balance }}</td>
													{% endif %}
												</tr>
											{% endfor %}
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>	
					</div>
				</div>
			</div>	
		</div>
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    {{ explorers|json_script:"explorers-data" }}

  	<script>  
	    $(document).ready(function() {
	       	var explorers = JSON.parse(document.getElementById('explorers-data').textContent);
	        $('#table_id').DataTable({
	        	"columns": [
			        { "data": "notary" },
			        { "data": "chain" },
			        { "data": "address" },
			        { "data": "balance" }
			    ],
        		order: [[ 0, 'asc' ], [ 0, 'asc' ], [ 1, 'asc' ]],
        		"columnDefs": [
        			{
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<a href='"+explorers[oData.chain]+'address/'+oData.address+"'>"+oData.address+"</a>");
				        }
			        },
        			{
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<a href='http://{{ request.get_host }}/notary_profile/"+oData.notary+"'>"+oData.notary+"</a>");
				        }
        			},
        			{
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<a href='http://{{ request.get_host }}/coin_profile/"+oData.chain+"'>"+oData.chain+"</a>");
				        }
        			}
        		]
	        });
	    });
  </script> 

{% endblock %}
