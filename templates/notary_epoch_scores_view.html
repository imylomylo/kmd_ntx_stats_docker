{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 mx-auto my-2" style="color:#FFF;">
		<div class="card kmd_ui_dark1_bg m-auto">
		<div class="card-header kmd_ui_dark1_bg m-auto">
			<h2>{{ page_title }}</h2>
			<h5>Total score: {{ total|floatformat:-3 }}</h5>
		</div>
			<div class="card-body kmd_ui_dark1_bg m-auto">
				<table id="epoch_scoring_table" class="table table-striped table-bordered kmd_ui_light4 m-auto" style="width:99%">
					<thead>
						<tr>
							<th data-data="server">Server</th>
							<th data-data="epoch">Epoch</th>
							<th data-data="chain">Chain</th>
							<th data-data="epoch_chain_ntx_count">NTX Count</th>
							<th data-data="score_per_ntx">Per NTX</th>
							<th data-data="epoch_chain_score">Score</th>
							<th data-data="detail">Detail</th>
						</tr>
					</thead>
					<tbody>
						{% for row in scoring_table %}
						<tr>
							<td data-data="server">{{ row.server }}</td>
							<td data-data="epoch">{{ row.epoch }}</td>
							<td data-data="chain">{{ row.chain }}</td>
							<td data-data="epoch_chain_ntx_count">{{ row.epoch_chain_ntx_count }}</td>
							<td data-data="score_per_ntx">{{ row.score_per_ntx }}</td>
							<td data-data="epoch_chain_score">{{ row.epoch_chain_score|floatformat:-3 }}</td>
							<td data-data="detail">
							{% if row.server == 'BTC' %}
								<a style="font-size: 0.9em;" href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_BTC&server=BTC">Transactions</a>
							{% elif row.server == 'KMD' %}
								<a style="font-size: 0.9em;" href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_KMD&server=KMD">Transactions</a>
							{% elif row.server == 'LTC' %}
								<a style="font-size: 0.9em;" href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_LTC&server=LTC">Transactions</a>
							{% else %}
								<a style="font-size: 0.9em;" href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_{{ row.epoch }}&server={{ row.server }}">Transactions</a>
							{% endif %}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<h6>Note: Unofficial Epoch (postseason or before / after official epochs) are not displayed.</h6>
		</div>	
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    {{ explorers|json_script:"explorers-data" }}
  	<script>
	    $(document).ready(function() {
	    	var explorers = JSON.parse(document.getElementById('explorers-data').textContent);
	        $('#epoch_scoring_table').DataTable({
	        	"paging": false,
        		order: [[ 0, 'asc' ],[ 1, 'asc' ],[ 2, 'asc' ]],
	        	"columns": [
			        { "data": "server" },
			        { "data": "epoch" },
			        { "data": "chain" },
			        { "data": "epoch_chain_ntx_count" },
			        { "data": "score_per_ntx" },
			        { "data": "epoch_chain_score" },
			        { "data": "detail" }
			    ],
        		"columnDefs": [
        			{
			            "data": 'chain',
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            		$(nTd).html("<a href='//{{ request.get_host }}/coin_profile/"+oData.chain+"'>"+oData.chain+"</a>");	
				            
				        }
        			},
        			{
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.server == "Main") {
			            		color = "#018022";
			            	}
			            	else if (oData.server == "Third_Party") {
			            		color = "#2863bb";
			            	}
			            	else if (oData.server == "Testnet") {
			            		color = "#622C7B";
			            	}
			            	else {
			            		color = "#000";	
			            	}
				            $(nTd).html("<span class='badge kmd_ui_dark1_bg p-1' style='background-color:"+color+" !important;'>"+oData.server.replace(/_/g, " ")+"</span>");
				        }
			        }
        		]
	        })
		});
    </script> 

{% endblock %}
