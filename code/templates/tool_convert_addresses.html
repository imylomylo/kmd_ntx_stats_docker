{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 mx-auto my-2" style="color: #b9b5b5;">
		<div class="card m-auto">
			<div class="card-header flex">
				<h2 class="col-12">Convert Coin Addresses</h2>
				<form>
				  <div class="input-group mb-3 " style="min-width: 50em">
				    <div class="input-group-prepend p-0" >
				      <span class="input-group-text  " style="color:white; border: solid grey 1px !important; line-height: 1em;">
				      	Enter Address
				      </span>
				    </div>
				    <input type="text" class="form-control m-auto " id="address_id" name="address" placeholder="{{ address }}"  style="border: solid grey 1px !important; font-size: 1em; line-height: 1em; text-align: center; min-width: 44em">
				    <div class="input-group-append p-0 ">
						<button class="append-btn"style="line-height: 1em; border: solid grey 1px !important;">
						    Get Converted Addresses
						</button>
				    </div>
				  </div>
				</form>
			</div>
			{% if address %}
				{% if address_rows %}
					<div class="card-body flex">
						<table id="converted_addresses" class="table table-striped table-bordered m-auto" style="width:99%; visibility: hidden;">
							<thead>
								<tr>
									<th data-data="chain">Chain</th>
									<th data-data="address">Address</th>
								</tr>
							</thead>
							<tbody>
								{% for item in address_rows %}
									<tr>
										<td style="font-size: 1.2em" data-data="chain">{{ item.chain }}</td>
										<td style="font-size: 1.2em" data-data="address">{{ item.address }}</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% endif %}
			{% endif %}
		</div>	
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  	{{ explorers|json_script:"explorers-data" }}

	{% if address_rows %}
  	<script>
	    $(document).ready(function() {
	    	$('#converted_addresses').css('visibility', 'visible');
	       	var explorers = JSON.parse(document.getElementById('explorers-data').textContent);
	        $('#converted_addresses').DataTable({
	        	"paging": true,
    			deferRender: true,
                "orderClasses": false,
	            "pageLength": 50,
        		order: [[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "chain" },
			        { "data": "address" }
			    ],
        		"columnDefs": [
        			{
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<span class='badge p-2'>"+oData.chain+"</span>");
				        }
			        },
        			{
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (!(explorers.hasOwnProperty(oData.chain))) {
			            		$(nTd).html("<span  class='badge p-2'>"+oData.address+"</span>");	
			            	}
			            	else if (explorers[oData.chain][0].search("cryptoid") > -1) {
			            		$(nTd).html("<a class='badge p-2' href='"+explorers[oData.chain][0]+'address.dws?'+oData.address+".htm'>"+oData.address+"</a>");	
			            	}
			            	else {
			            		$(nTd).html("<a class='badge p-2' href='"+explorers[oData.chain][0]+'address/'+oData.address+"'>"+oData.address+"</a>");	
			            	}
			            }
			        }
        		]
	        });
	    });
    </script> 
    {% endif %}
{% endblock %}
