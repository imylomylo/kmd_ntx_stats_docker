{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 m-auto">
		<div class="card table_card">
			<div class="card-header table_card_title flex">
				{{ page_title }}
				<div style="font-size: smaller ;">Total score: {{ total|floatformat:-3 }}</div>
			</div>
			<div class="card-body table_card_body">
				<table id="epoch_scoring_table" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th class="py-2 px-4" data-data="chain">Chain</th>
							<th class="py-2 px-4" data-data="server">Server</th>
							<th class="py-2 px-4" data-data="epoch">Epoch</th>
							<th class="py-2 px-4" data-data="epoch_chain_ntx_count">NTX Count</th>
							<th class="py-2 px-4" data-data="score_per_ntx">Per NTX</th>
							<th class="py-2 px-4" data-data="epoch_chain_score">Score</th>
							<th class="py-2 px-4" data-data="detail">Detail</th>
						</tr>
					</thead>
					<tbody>
						{% for row in scoring_table %}
						<tr>
							<td class="pr-2 pl-3 text-left" data-data="chain">
								{{ row.chain }}
							</td>
							<td data-data="server">
								{{ row.server }}
							</td>
							<td data-data="epoch">
									{{ row.epoch }}
							</td>
							<td data-data="epoch_chain_ntx_count">
								{{ row.epoch_chain_ntx_count }}
							</td>
							<td data-data="score_per_ntx">
								{{ row.score_per_ntx }}
							</td>
							<td data-data="epoch_chain_score">
								{{ row.epoch_chain_score|floatformat:-3 }}
							</td>
							<td style='font-size: 1em;' data-data="detail">
								<span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='{{ notary }} {{ row.chain }} epoch {{ row.epoch }} score detail'>
									<a href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_{{ row.epoch }}&server={{ row.server }}">
										<i class='fas fa-arrow-right'></i>
									</a>
								</span>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="card-footer table_card_footer flex">
				Note: Unofficial Epoch (postseason or before / after official epochs) are not displayed.
			</div>
		</div>	
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    {{ explorers|json_script:"explorers-data" }}
  	<script>
	    $(document).ready(function() {
	    	var explorers = JSON.parse(document.getElementById('explorers-data').textContent);
	        $('#epoch_scoring_table').DataTable({
	        	"paging": false,
    			deferRender: true,
                "orderClasses": false,
        		order: [[ 0, 'asc' ],[ 1, 'asc' ],[ 2, 'asc' ]],
	        	"columns": [
			        { "data": "chain" },
			        { "data": "server" },
			        { "data": "epoch" },
			        { "data": "epoch_chain_ntx_count" },
			        { "data": "score_per_ntx" },
			        { "data": "epoch_chain_score" },
			        { "data": "detail" }
			    ],
        		"columnDefs": [
        			{
			            "data": 'chain',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	var icon = oData.chain.toLowerCase()
			            	if (icon == "wlc21") {
			            		icon = "wlc"
			            	} else if (icon == "gleec-old") {
			            		icon = "gleec"
			            	} else if (icon == "coquicash") {
			            		icon = "coqui"
			            	} else if (icon == "tokel") {
			            		icon = "tkl"
			            	}
				            $(nTd).html("<span class='p-2 mr-auto' style='font-size: 0.9em;'><a href='//{{ request.get_host }}/coin_profile/"+oData.chain+"/?season=Season_4'><img height='16' class='mr-2' src='https://raw.githubusercontent.com/KomodoPlatform/coins/master/icons/"+icon+".png' />"+oData.chain+"</a></span>");
				        }
        			},
        			{
			            "data": 'server',
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.server == "Main") {
			            		color = "#115621";
			            	}
			            	else if (oData.server == "Third_Party") {
			            		color = "#2b53ad";
			            	}
			            	else if (oData.server == "Testnet") {
			            		color = "#622C7B";
			            	}
			            	else {
			            		color = "#000";	
			            	}
				            $(nTd).html(oData.server.replace(/_/g, " "));
				        }
			        }
        		]
	        })
		});
    </script> 

{% endblock %}
