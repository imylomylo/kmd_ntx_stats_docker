{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 mx-auto my-2" style="color: #b9b5b5;">
		<div class="card m-auto">
		<div class="card-header m-auto col-12">
			<h2>{{ page_title }}</h2>
			<h5>Total score: {{ total|floatformat:-3 }}</h5>
		</div>
			<div class="card-body col-12 m-auto">
				<table id="epoch_scoring_table" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th class="py-2 px-4" data-data="server">Server</th>
							<th class="py-2 px-4" data-data="epoch">Epoch</th>
							<th class="py-2 px-4" data-data="chain">Chain</th>
							<th class="py-2 px-4" data-data="epoch_chain_ntx_count">NTX Count</th>
							<th class="py-2 px-4" data-data="score_per_ntx">Per NTX</th>
							<th class="py-2 px-4" data-data="epoch_chain_score">Score</th>
							<th class="py-2 px-4" data-data="detail">Detail</th>
						</tr>
					</thead>
					<tbody>
						{% for row in scoring_table %}
						<tr>
							<td class="pr-2 pl-3 text-left" style='font-size: 1em;' data-data="chain">
								{{ row.chain }}
							</td>
							<td style='font-size: 1.2em;' data-data="server">
								{{ row.server }}
							</td>
							<td style='font-size: 1.2em;' data-data="epoch">
							  	<span class='badge p-2'>
									{{ row.epoch }}
								</span>
							</td>
							<td style='font-size: 1.2em;' data-data="epoch_chain_ntx_count">
							  	<span class='badge p-2'>
								{{ row.epoch_chain_ntx_count }}
								</span>
							</td>
							<td style='font-size: 1.2em;' data-data="score_per_ntx">
							  	<span class='badge p-2'>
								{{ row.score_per_ntx }}
								</span>
							</td>
							<td style='font-size: 1.2em;' data-data="epoch_chain_score">
							  	<span class='badge p-2'>
								{{ row.epoch_chain_score|floatformat:-3 }}
								</span>
							</td>
							<td style='font-size: 1.2em;' data-data="detail">
							{% if row.server == 'BTC' %}
								<a href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_BTC&server=BTC">
									<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='{{ item.notary }} score detail'>
										<i class='fas fa-arrow-right'></i>
									</span>								</a>
							{% elif row.server == 'KMD' %}
								<a href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_KMD&server=KMD">
									<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='{{ item.notary }} score detail'>
										<i class='fas fa-arrow-right'></i>
									</span>
								</a>
							{% elif row.server == 'LTC' %}
								<a href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_LTC&server=LTC">
									<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='{{ item.notary }} score detail'>
										<i class='fas fa-arrow-right'></i>
									</span>
								</a>
							{% else %}
								<a href="//{{ request.get_host }}/api/table/notarised/?notary={{ notary }}&chain={{ row.chain }}&season={{ season }}&epoch=Epoch_{{ row.epoch }}&server={{ row.server }}">
									<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='{{ item.notary }} score detail'>
										<i class='fas fa-arrow-right'></i>
									</span>
								</a>
							{% endif %}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				<h6>Note: Unofficial Epoch (postseason or before / after official epochs) are not displayed.</h6>
			</div>
		</div>	
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    {{ explorers|json_script:"explorers-data" }}
  	<script>
	    $(document).ready(function() {
	    	var explorers = JSON.parse(document.getElementById('explorers-data').textContent);
	        $('#epoch_scoring_table').DataTable({
	        	"paging": false,
        		order: [[ 1, 'asc' ],[ 2, 'asc' ],[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "chain" },
			        { "data": "server" },
			        { "data": "epoch" },
			        { "data": "epoch_chain_ntx_count" },
			        { "data": "score_per_ntx" },
			        { "data": "epoch_chain_score" },
			        { "data": "detail" }
			    ],
        		"columnDefs": [
        			{
			            "data": 'chain',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	var icon = oData.chain.toLowerCase()
			            	if (icon == "wlc21") {
			            		icon = "wlc"
			            	} else if (icon == "gleec-old") {
			            		icon = "gleec"
			            	} else if (icon == "coquicash") {
			            		icon = "coqui"
			            	}
				            $(nTd).html("<span class='badge p-2 mr-auto' style='font-size: 0.9em;'><a href='//{{ request.get_host }}/coin_profile/"+oData.chain+"/?season=Season_4'><img height='16px' class='mr-2' src='https://raw.githubusercontent.com/KomodoPlatform/coins/master/icons/"+icon+".png' />"+oData.chain+"</a></span>");
				        }
        			},
        			{
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.server == "Main") {
			            		color = "#115621";
			            	}
			            	else if (oData.server == "Third_Party") {
			            		color = "#2b53ad";
			            	}
			            	else if (oData.server == "Testnet") {
			            		color = "#622C7B";
			            	}
			            	else {
			            		color = "#000";	
			            	}
				            $(nTd).html("<span class='badge p-2' style='background-color:"+color+" !important;'>"+oData.server.replace(/_/g, " ")+"</span>");
				        }
			        }
        		]
	        })
		});
    </script> 

{% endblock %}
