{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 m-auto">
		<div class="card table_card">
			<div class="card-header table_card_title flex">
				RICK / MORTY Faucet
			</div>
			<div class="card-body table_card_body">
				<div class="m-auto card-text my-3">
        			{% if result == 'fail' %}
						<img src="{% static 'img/faucet/drink_fail.gif' %}" alt="Failed" class="faucet-img" />
        			{% elif result == 'disqualified' %}
						<img src="{% static 'img/faucet/disqualified.gif' %}" alt="Disqualified"  class="faucet-img" />
        			{% elif result == 'RICK_success' %}
						<img src="{% static 'img/faucet/rick_drink.png' %}" alt="Drink with Rick"  class="faucet-img" />
        			{% elif result == 'MORTY_success' %}
						<img src="{% static 'img/faucet/morty_drink.png' %}" alt="Drink with Morty"  class="faucet-img" />
        			{% else %}
						<img src="{% static 'img/faucet/faucet.png' %}" alt="Faucet"  class="faucet-img" />
        			{% endif %}                            			
				</div>
				<div class="card-text">
					<form action="#" method="post" class="col-6 m-auto">
						{% csrf_token %}


						<div class="input-group my-3">
						    <div class="input-group-prepend prepend-label-left p-0 col-3">
						        <span class="input-group-text prepend-span">
						      	    Coin
						        </span>
						    </div>
							<select class="form-control col-9" id='coin' name="coin" style='width: 160px;'>
							      <option value="RICK">RICK</option>
							      <option value="MORTY">MORTY</option>
							</select>
						</div>

						<div class="input-group mb-3" >
							<div class="input-group-prepend prepend-label-left p-0 col-3">
							  <span class="input-group-text prepend-span">
							  	Address
							  </span>
							</div>
							<input type="text" class="form-control col-9" id="address" name="address" placeholder="RTUfq3PgPPMVY1YZa3P18icFNDsHpicKLe">
						</div>

						<button class="btn-dark4 col-4" type="submit">
						    Drip
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div class="row col-12 m-auto">
		<div class="card table_card">
			<div class="card-header table_card_title flex">
				Last 250 Faucet Transactions
			</div>
			<div class="card-body table_card_body pb-0">
				<table style="visibility: hidden;" id="faucet_tx_tbl" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th data-data="coin">Coin</th>
							<th data-data="address">Address</th>
							<th data-data="amount">Amount</th>
							<th data-data="txid">Transaction</th>
							<th data-data="status">Status</th>
							<th data-data="time_sent">Time Sent</th>
						</tr>
					</thead>
					<tbody>
					{% for row in tx_rows %}
						<tr>
							<td data-data="coin" class="px-2 text-left">{{ row.coin }}</td>
							<td data-data="address">{{ row.address }}</td>
							<td data-data="amount">
								<span>
									{{ row.amount }}
								</span>
							</td>
							<td data-data="txid">{{ row.txid }}</td>
							<td data-data="status">{{ row.status }}</td>
							<td data-data="time_sent">
								<span>
									{{ row.time_sent }}
								</span>
							</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="card-footer table_card_footer flex">
				<div class="mx-auto">Rick Supply: {{ faucet_supply.RICK }}</div>
				<div class="m-auto">Morty Supply: {{ faucet_supply.MORTY }}</div>
				<div class="m-auto">24 hr Drips: {{ count_24hrs }}</div>
				<div class="m-auto">24 hr Drip Value: {{ sum_24hrs }}</div>
			</div>			
		</div>
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script>
	    $(document).ready(function() {
	    	$('#faucet_tx_tbl').css('visibility', 'visible');
	        $('#faucet_tx_tbl').DataTable({
  				"pageLength": 25,
    			deferRender: true,
                "orderClasses": false,
    			"paging": true,
        		order: [[ 4, 'asc' ]],
        		"columnDefs": [
        			{
			            "data": 'coin',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	var icon = oData.coin.toLowerCase()
			            	if (icon == "wlc21") {
			            		icon = "wlc"
			            	} else if (icon == "gleec-old") {
			            		icon = "gleec"
			            	} else if (icon == "coquicash") {
			            		icon = "coqui"
			            	}
				            $(nTd).html("<span class='p-2 mr-auto'><a href='//{{ request.get_host }}/coin_profile/"+oData.coin+"'><img height='16' class='mr-2' src='https://raw.githubusercontent.com/KomodoPlatform/coins/master/icons/"+icon+".png' />"+oData.coin+"</a></span>");
				        }
			        },
        			{
			            "data": 'address',
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.address == 'GalacticFederationPrison') {
				            	$(nTd).html("<a href='https://www.galacticfederation.org.uk/'>"+oData.address+"</a></span>");			            		
			            	}
			            	else {
				            	$(nTd).html("<a href='https://"+oData.coin+".explorer.dexstats.info/address/"+oData.address+"'>"+oData.address+"</a></span>");
				        	}	
				        }
			        },
        			{
			            "data": 'txid',
			            "targets": 3,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.address == 'GalacticFederationPrison') {
				            	$(nTd).html("<a href='https://www.galacticfederation.org.uk/'><span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='Galactic Federation Prison'><i class='fab fa-galactic-senate'></i></span></a>");
			            	} else if (oData.txid == 'n/a') {
				            	$(nTd).html("<span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='Awaiting drip...'><i class='fas fa-hourglass-half' style='color:white'></i></i></span>");
			            	}
			            	else {
				            	$(nTd).html("<a href='https://"+oData.coin+".explorer.dexstats.info/tx/"+oData.txid+"'><span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='View "+oData.txid+" on block explorer'><i class='fa fa-search'></i></span></a>");
				            }
				        }
			        },
        			{
			            "data": 'status',
			            "targets": 4,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.status == 'pending') {
				            	$(nTd).html("<span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='In queue...'><i class='far fa-clock' style='color:white;'></i></span>");			            		
			            	} else if (oData.status == 'sent') {
				            	$(nTd).html("<span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='Sent!'><i class='fas fa-envelope-open-text' style='color:white;'></i></span>");			            		
			            	}
			            	else {			            		
				            	$(nTd).html("<span class='p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='In queue...'><i class='far fa-clock' style='color:white;'>"+oData.status+"<i class='far fa-clock' style='color:white;'></i></span>");	
			            	}
				        }
			        }
			    ]
	        });
	    });
	</script>

{% endblock %}