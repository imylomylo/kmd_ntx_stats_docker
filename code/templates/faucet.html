{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 mx-auto my-1" style="color: #b9b5b5;">
		<div class="card-deck d-flex justify-content-between col-12 m-auto">
			<div class="card text-center kmd_ui_light3 shadow-none">
				<div class="card-header d-flex justify-content-between">
					<h3 class="m-auto">RICK / MORTY Faucet</h3>
				</div>
				<div class="card-body p-0">
					<div class="m-auto card-text">
            			{% if result == 'fail' %}
							<img src="{% static 'img/faucet/drink_fail.gif' %}" alt="Failed" />
            			{% elif result == 'disqualified' %}
							<img src="{% static 'img/faucet/disqualified.gif' %}" alt="Disqualified" />
            			{% elif result == 'RICK_success' %}
							<img src="{% static 'img/faucet/rick_drink.png' %}" alt="Drink with Rick" />
            			{% elif result == 'MORTY_success' %}
							<img src="{% static 'img/faucet/morty_drink.png' %}" alt="Drink with Morty" />
            			{% else %}
							<img src="{% static 'img/faucet/faucet.png' %}" alt="Faucet" />
            			{% endif %}                            			
					</div>
					<div class="card-text">
						<form action="#" method="post" class="col-6 m-auto">
							{% csrf_token %}
							<fieldset>
								<div class="form-group">
								  <label class="col-md-4 control-label" for="coin">Coin</label>
								  <span class="col-md-2">
								    <select id="coin" name="coin" class="form-control">
								      <option value="RICK">RICK</option>
								      <option value="MORTY">MORTY</option>
								    </select>
								  </span>
								</div>
								<div class="form-group">
								  <label class="col-md-4 control-label" for="address">Address</label>  
								  <span class="col-md-4">
								  	<input id="address" name="address" type="text" placeholder="RTUfq3PgPPMVY1YZa3P18icFNDsHpicKLe" class="form-control input-md">
								    
								  </span>
								</div>
								<div class="form-group col-4 m-auto">
							    	<input type="submit" value="DRIP">
							    </div>
							</fieldset>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row col-12 mx-auto my-1" style="color: #b9b5b5;">
		<div class="card m-auto">
			<div class="card-header m-auto">
				<h3>Last 200 Faucet Transactions</h3>
			</div>			
			<div class="card-body m-auto col-12">
				<table style="visibility: hidden;" id="faucet_tx_tbl" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th data-data="coin">Coin</th>
							<th data-data="address">Address</th>
							<th data-data="amount">Amount</th>
							<th data-data="txid">Transaction</th>
							<th data-data="status">Status</th>
							<th data-data="time_sent">Time Sent</th>
						</tr>
					</thead>
					<tbody>
					{% for row in tx_rows %}
						<tr>
							<td style="font-size: 1.1em;" data-data="coin" class="px-2 text-left">{{ row.coin }}</td>
							<td style="font-size: 1.1em;" data-data="address">{{ row.address }}</td>
							<td style="font-size: 1.1em;" data-data="amount">
								<span class='badge p-2'>
									{{ row.amount }}
								</span>
							</td>
							<td style="font-size: 0.9em;" data-data="txid">{{ row.txid }}</td>
							<td style="font-size: 0.9em;" data-data="status">{{ row.status }}</td>
							<td style="font-size: 1em;" data-data="time_sent">
								<span class='badge p-2'>
									{{ row.time_sent }}
								</span>
							</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="card-footer m-auto col-12">
				<div class="mx-auto mt-3">Rick Supply: {{ faucet_supply.RICK }}</div>
				<div class="m-auto">Morty Supply: {{ faucet_supply.MORTY }}</div>
				<div class="m-auto">24 hr Drips: {{ count_24hrs }}</div>
				<div class="m-auto">24 hr Drip Value: {{ sum_24hrs }}</div>
			</div>			
		</div>
	</div>
    <!-- jquery -->
  
  	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script>
	    $(document).ready(function() {
	    	$('#faucet_tx_tbl').css('visibility', 'visible');
	        $('#faucet_tx_tbl').DataTable({
  				"pageLength": 25,
    			deferRender: true,
                "orderClasses": false,
    			"paging": true,
        		order: [[ 4, 'asc' ]],
        		"columnDefs": [
        			{
			            "data": 'coin',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	var icon = oData.coin.toLowerCase()
			            	if (icon == "wlc21") {
			            		icon = "wlc"
			            	} else if (icon == "gleec-old") {
			            		icon = "gleec"
			            	} else if (icon == "coquicash") {
			            		icon = "coqui"
			            	}
				            $(nTd).html("<span class='badge p-2 mr-auto'><a href='//{{ request.get_host }}/coin_profile/"+oData.coin+"'><img height='16' class='mr-2' src='https://raw.githubusercontent.com/KomodoPlatform/coins/master/icons/"+icon+".png' />"+oData.coin+"</a></span>");
				        }
			        },
        			{
			            "data": 'address',
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.address == 'GalacticFederationPrison') {
				            	$(nTd).html("<span class='badge p-2'><a href='https://www.galacticfederation.org.uk/'>"+oData.address+"</a></span>");			            		
			            	}
			            	else {
				            	$(nTd).html("<span class='badge p-2'><a href='https://"+oData.coin+".explorer.dexstats.info/address/"+oData.address+"'>"+oData.address+"</a></span>");
				        	}	
				        }
			        },
        			{
			            "data": 'txid',
			            "targets": 3,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.address == 'GalacticFederationPrison') {
				            	$(nTd).html("<a href='https://www.galacticfederation.org.uk/'><span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='Galactic Federation Prison'><i class='fab fa-galactic-senate'></i></span></a>");
			            	} else if (oData.txid == 'n/a') {
				            	$(nTd).html("<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='Awaiting drip...'><i class='fas fa-hourglass-half' style='color:white'></i></i></span>");
			            	}
			            	else {
				            	$(nTd).html("<a href='https://"+oData.coin+".explorer.dexstats.info/tx/"+oData.txid+"'><span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='View "+oData.txid+" on block explorer'><i class='fa fa-search'></i></span></a>");
				            }
				        }
			        },
        			{
			            "data": 'status',
			            "targets": 4,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.status == 'pending') {
				            	$(nTd).html("<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='In queue...'><i class='far fa-clock' style='color:white;'></i></span>");			            		
			            	} else if (oData.status == 'sent') {
				            	$(nTd).html("<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='Sent!'><i class='fas fa-envelope-open-text' style='color:white;'></i></span>");			            		
			            	}
			            	else {			            		
				            	$(nTd).html("<span class='badge p-0' style='border-radius: 50%;' data-toggle='tooltip' data-placement='top' title='In queue...'><i class='far fa-clock' style='color:white;'>"+oData.status+"<i class='far fa-clock' style='color:white;'></i></span>");	
			            	}
				        }
			        }
			    ]
	        });
	    });
	</script>

{% endblock %}