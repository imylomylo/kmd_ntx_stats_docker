{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row my-3 col-5 m-auto">
		<div class="card text-center kmd_ui_light3 col-12 px-0">
			<div class="card-footer">
			 	Swap Data Filter
			</div>
			<div class="card-body">
			    <form>
				    {% include 'components/form/input_timespan.html' %}
					<row>
					    <div class="input-group col-12">
					    	<div class="col-8">
				    		    {% include 'components/form/dropdown_since.html' %}
							</div>
					    	<div class="col-4">
				    		    {% include 'components/buttons/btn_update.html' %}
						    </div>
						</div>
					</row>
			    </form>
			</div>
		</div>
	</div>
	<div class="row my-3">
		<div class="card-deck d-flex justify-content-between col-12 m-auto">
			<div class="card text-center kmd_ui_light3 col-6 px-0">
				<div class="card-header d-flex justify-content-between">
					<div class="my-auto">
						Taker GUI Swap Totals (<span id="taker_swap_total"></span>)
					</div>
					<div class="my-auto">
						{{ from_time_dt|date:"H:i d M Y" }} to {{ to_time_dt|date:"H:i d M Y" }}
					</div>
				</div>
				<div class="card-body">
				    <canvas id="taker_totals"></canvas> 
				</div>	
			</div>	
			<div class="card text-center kmd_ui_light3 col-6 px-0">
				<div class="card-header d-flex justify-content-between">
					<div class="my-auto">
						Maker GUI Swap Totals (<span id="maker_swap_total"></span>)
					</div>
					<div class="my-auto">
						{{ from_time_dt|date:"H:i d M Y" }} to {{ to_time_dt|date:"H:i d M Y" }}
					</div>
				</div>
				<div class="card-body">
				    <canvas id="maker_totals"></canvas> 
				</div>	
			</div>	
		</div>	
	</div>	
	<div class="row my-3">
		<div class="card-deck d-flex justify-content-between col-12 m-auto">
			<div class="card text-center  kmd_ui_light3 col-6 px-0">
				<div class="card-header  d-flex justify-content-between">
					<div class="my-auto">
						Taker GUI Pubkey Totals (<span id="taker_pub_total"></span>)
					</div>
					<div class="my-auto">
						{{ from_time_dt|date:"H:i d M Y" }} to {{ to_time_dt|date:"H:i d M Y" }}
					</div>
				</div>
				<div class="card-body">
				    <canvas id="taker_pubkeys"></canvas> 
				</div>	
			</div>	
			<div class="card text-center  kmd_ui_light3 col-6 px-0">
				<div class="card-header  d-flex justify-content-between">
					<div class="my-auto">
						Maker GUI Pubkey Totals (<span id="maker_pub_total"></span>)
					</div>
					<div class="my-auto">
						{{ from_time_dt|date:"H:i d M Y" }} to {{ to_time_dt|date:"H:i d M Y" }}
					</div>
				</div>
				<div class="card-body">
				    <canvas id="maker_pubkeys"></canvas> 
				</div>	
			</div>	
		</div>	
	</div>

	{% include 'components/tables/mm2_guis.html' %}
  	<script>
	    $(document).ready(function() {
	        $('#balances_table').DataTable({
	           "paging": false,
        		order: [[ 0, 'asc' ], [ 1, 'asc' ], [ 2, 'asc' ]],
        		"columnDefs": [
			        {
			            "data": "notary",
		                "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<span class='badge p-2' style='font-size: 0.9em;'><a href='//{{ request.get_host }}/notary_profile/"+oData.notary+"/?season={{ season }}'>"+oData.notary+"</a></span>");
				        }
		            },
        			{
			            "data": "address",
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<span class='badge p-2' style='font-size: 0.9em;'><a href='"+explorers['{{ coin }}'][0]+'address/'+oData.address+"'>"+oData.address+"</a></span>");
				        }
			        },
        			{
			            "data": "balance",
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html("<span class='badge p-2' style='font-size: 0.9em;'>"+oData.balance+"</a></span>");
				        }
			        },
        			{
			            "data": "server",
			            "targets": 3,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	if (oData.server == "Main") {
			            		color = "#115621";
			            	}
			            	else if (oData.server == "Third_Party") {
			            		color = "#2b53ad";
			            	}
			            	else if (oData.server == "Testnet") {
			            		color = "#622C7B";
			            	}
			            	else {
			            		color = "#000";	
			            	}
				            $(nTd).html("<span class='badge p-2' style='background-color:"+color+" !important;'>"+oData.server+"</span>");
			        	}
			        },
        			{
			            "data": 'update_time',
			            "targets": 4,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(get_time_since(oData.update_time));
			            }
			        }
        		]
	        });
	    });
	    $.ajax({ 
	      method: "GET", 
	      url: '//{{ request.get_host }}/api/graph/mm2gui/?from_time={{ from_time }}&to_time={{ to_time }}', 
	      success: function(data) { 
	      	//document.getElementById('graph_title').innerHTML = data.chartLabel;
	        drawPieGraph(data['results']['maker_swap_total'], 'maker_totals'); 
	        //drawPieGraph(data['results']['maker_pct'], 'maker_pct'); 
	        drawPieGraph(data['results']['taker_swap_total'], 'taker_totals'); 
	        //drawPieGraph(data['results']['taker_pct'], 'taker_pct'); 
	        drawPieGraph(data['results']['taker_pubkey_total'], 'taker_pubkeys'); 
	        drawPieGraph(data['results']['maker_pubkey_total'], 'maker_pubkeys'); 
	        document.getElementById('taker_pub_total').innerHTML = data['results']['taker_pubkey_total']["total"]; 
	        document.getElementById('maker_pub_total').innerHTML = data['results']['maker_pubkey_total']["total"]; 
	        document.getElementById('taker_swap_total').innerHTML = data['results']['taker_swap_total']["total"]; 
	        document.getElementById('maker_swap_total').innerHTML = data['results']['maker_swap_total']["total"]; 
	        console.log("drawing"); 
	      }, 
	      error: function(error_data) { 
	        console.log(error_data); 
	      } 
	    }) 
  </script> 

{% endblock %}
