{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="row col-12 m-auto">
	<div class="card table_card floating-card m-auto col-12" id="faucet-tx_card" style="font-size: 1.1em;" >
		<div class="card-header table_card_header col-12">
			<h3>Notary Faucet</h3>
		</div>
		<div class="card-body table_card_body col-12" style="opacity: 1;" id="">
			<form action="#" method="post" class="col-12 m-auto p-0">
				{% csrf_token %}
				<div class="input-group my-1" >
					<div class="input-group-prepend prepend-label-left p-0 col-1">
					  <span class="input-group-text prepend-span">
					  	Pubkey
					  </span>
					</div>
					<input type="text" class="form-control col-7 mr-auto" id="pubkey" name="pubkey" placeholder="02f9a7b49282885cd03969f1f5478287497bc8edfceee9eac676053c107c5fcdaf">
				    <div class="ml-auto input-group-prepend prepend-label-left p-0 col-1">
				        <span class="input-group-text prepend-span">
				      	    Coin
				        </span>
				    </div>
					<select class="form-control col-1" id='coin' name="coin" style='width: 160px;'>
						{% for coin in coins_list %}
					      <option value="{{ coin }}">{{ coin }}</option>
						{% endfor %}
					</select>
					<div class="input-group-append p-0">
						<button class="append-btn px-4" type="submit">Drip</button>
					</div>
				</div>
			</form>
		</div>

		<div class="card-body table_card_body col-12" style="opacity: 1;" id="accrued-faucet-tx">
			<table style="visibility: hidden;" id="faucet-tx_tbl" class="table table-striped table-bordered m-auto" style="width:100%">
				<thead>
					<tr>
						<th data-data="coin">Coin</th>
						<th data-data="notary">Notary</th>
						<th data-data="amount">Amount</th>
						<th data-data="txid">Transaction</th>
						<th data-data="status">Status</th>
						<th data-data="time_sent">Time Sent</th>
					</tr>
				</thead>
				<tbody>
				{% for row in tx_rows %}
					<tr>
						<td data-data="coin" class="px-2 text-left text-nowrap">{{ row.coin }}</td>
						<td data-data="notary">{{ row.notary }}</td>
						<td data-data="amount">{{ row.amount }}</td>
						<td data-data="txid">{{ row.txid }}</td>
						<td data-data="status">{{ row.status }}</td>
						<td data-data="time_sent" class="text-nowrap">{{ row.time_sent }}</td>
					</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>

		<div class="card-body table_card_body col-12" style="opacity: 1;" id="accrued-faucet-balances">
			<table style="visibility: hidden;" id="faucet-balances_tbl" class="table table-striped table-bordered m-auto" style="width:100%">
				<thead>
					<tr>
						<th data-data="coin">Coin</th>
						<th data-data="address">Address</th>
						<th data-data="balance">Balance</th>
					</tr>
				</thead>
				<tbody>
				{% for coin, values in faucet_balances.items %}
					<tr>
						<td data-data="coin" class="px-2 text-left text-nowrap">{{ coin }}</td>
						<td data-data="address">{{ values.address }}</td>
						<td data-data="balance">{{ values.balance }}</td>
					</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>
	</div>

	<script>
	    $(document).ready(function() {
	    	const dom = '{% include "components/tables/dt_dom.html" with table="faucet-balances" %}'

	    	$('#faucet-balances_tbl').css('visibility', 'visible');
	        $('#faucet-balances_tbl').DataTable({
    			"deferRender": true,
    			"dom": dom,
                "orderClasses": false,
        		"order": [[ 0, 'desc' ]],
        		"columnDefs": [
					{ "className": "text-right text-nowrap", "targets": [ 2 ] },
					{ "className": "text-left text-nowrap", "targets": [ 0 ] },
        			{
			            "data": 'coin',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(get_coin_icon(oData.coin))
				        }
			        },
        			{
			            "data": 'address',
			            "targets": 1,
						"fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
							if (oData.balance > 0) {
								$(nTd).html(get_address_url(oData.coin, oData.address));
							} else {
								$(nTd).html("<span>Insight API endpoint unresponsive!</span>");
							}
						}
			        },
        			{
			            "data": 'balance',
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(
			            		isNaN(oData.balance) ? "N/A" :
			            		parseFloat(oData.balance).toFixed(3)
			            	);
				        }
			        }
			    ],
		        fnInitComplete: function(oTable, oData){
		        	let url = ""
		            let api_btn = ''
		            $('.faucet-balances-api-link').html(api_btn);
				    $('.faucet-balances-tbl-title').html('<h4 class="text-left">Faucet Balances</h4>');
		        }
	        });
	    });
	</script>
	<script>
	    $(document).ready(function() {
	    	const dom = '{% include "components/tables/dt_dom.html" with table="faucet-tx" %}'

	    	$('#faucet-tx_tbl').css('visibility', 'visible');
	        $('#faucet-tx_tbl').DataTable({
    			"deferRender": true,
    			"dom": dom,
                "orderClasses": false,
        		"order": [[ 5, 'desc' ]],
        		"columnDefs": [
					{ "className": "text-right text-nowrap", "targets": [ 2 ] },
					{ "className": "text-left text-nowrap", "targets": [ 0 ] },
        			{
			            "data": 'coin',
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(get_coin_icon(oData.coin))
				        }
			        },
        			{
			            "data": 'notary',
			            "targets": 1,
						"fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
							$(nTd).html(get_notary_url('{{ season }}', oData.notary));
						}
			        },
        			{
			            "data": 'amount',
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(
			            		isNaN(oData.amount) ? "N/A" :
			            		parseFloat(oData.amount).toFixed(3)
			            	);
				        }
			        },
        			{
			            "data": 'txid',
			            "targets": 3,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html('<span style="0.8em">'+get_faucet_txid(oData.coin, oData.txid)+"</span>");
				        }
			        },
        			{
			            "data": 'status',
			            "targets": 4,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html(get_faucet_status(oData.status));
				        }
			        }
			    ],
		        fnInitComplete: function(oTable, oData){
		        	let url = ""
		            let api_btn = ''
		            $('.faucet-tx-api-link').html(api_btn);
				    $('.faucet-tx-tbl-title').html('<h4 class="text-left">Last 200 Faucet Transactions</h4>');
		            
		        }
	        });
	    });
	</script>

{% endblock %}