{% extends "base.html" %}
{% load static %}
{% block content %}
	<div class="row col-12 m-auto">
		<div class="card table_card">
			<div class="card-header table_card_title flex">
				Komodo Active User Rewards
			</div>
			<div class="card-body table_card_body">
				<form>
					{% include "components/form/text_input_line.html" with prepend_text="Enter KMD Address" input_id="address" placeholder_text=address append_btn_text="Show Rewards" %}
				</form>
			{% if kmd_rewards_rows %}
				<table id="opret_table" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th data-data="block_height">Block Height</th>
							<th data-data="utxo_value">UTXO Value</th>
							<th data-data="reward">Reward</th>
							<th data-data="utxo_age">UTXO Age</th>
							<th data-data="txid">Transaction</th>
						</tr>
					</thead>
					<tbody>
						{% for item in kmd_rewards_rows %}
							<tr>
								<td data-data="block_height">{{ item.block_height }}</td>
								<td data-data="utxo_value">{{ item.utxo_value }}</td>
								<td data-data="reward">{{ item.kmd_rewards }}</td>
								<td data-data="utxo_age">{{ item.utxo_age }}</td>
								<td data-data="txid">{{ item.txid }}</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% endif %}
			{% if not address_error and address %}
			<div class="card-footer table_card_footer flex">
				<h6><b>Address:</b> <a href='https://komodod.com/a/{{ address }}'>{{ address }}</a></h6>
				<div style="font-size: 1.2em; background-color:black; border: solid 1px grey" class="badge p-3">
					<b>Total rewards:</b> {{ total_rewards }} KMD
				</div>
				<h6 class="mt-2"><b>UTXOs eligible:</b> {{ eligible_utxo_count }}/{{ utxo_count }}</h6>
				<h6 class="mt-2"><b>Balance:</b> {{ kmd_balance }}</h6>
			</div>
			{% endif %}
		</div>	
	</div>
  	
  	<script>
	    $(document).ready(function() {
	        $('#opret_table').DataTable({
	        	"paging": true,
    			deferRender: true,
                "orderClasses": false,
	            "pageLength": 50,
        		order: [[ 0, 'asc' ]],
	        	"columns": [
			        { "data": "block_height" },
			        { "data": "utxo_value" },
			        { "data": "reward" },
			        { "data": "utxo_age" },
			        { "data": "txid" }
			    ],
        		"columnDefs": [
        			{
			            "data": "block_height",
			            "targets": 0,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(get_block_url(oData.coin, oData.block_height))
				        }
			        },
        			{
			            "data": "utxo_value",
			            "targets": 1,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html(oData.utxo_value);
				        }
			        },
        			{
			            "data": "reward",
			            "targets": 2,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html(oData.reward);
				        }
			        },
        			{
			            "data": 'utxo_age',
			            "targets": 3,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
			            	$(nTd).html(get_time_since(oData.utxo_age));
				        }
			        },
        			{
			            "data": 'txid',
			            "targets": 4,
			            "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
				            $(nTd).html(get_txid_url(oData.coin, oData.txid));
				        }
			        }
        		]
	        });
	    });
    </script> 
{% endblock %}
